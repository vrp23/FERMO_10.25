<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="report_partner_commission_document">
        <t t-call="web.external_layout">
            <div class="page">
                <div class="oe_structure"/>
                
                <h2 class="text-center">LIQUIDACIÓN DE COMISIONES DE SOCIOS</h2>
                <h3 class="text-center"><span t-field="doc.period_display"/></h3>
                
                <!-- Información General -->
                <div class="row mt-4">
                    <div class="col-12">
                        <table class="table table-sm">
                            <tr>
                                <td width="30%"><strong>Número:</strong></td>
                                <td><span t-field="doc.name"/></td>
                            </tr>
                            <tr>
                                <td><strong>Fecha de Liquidación:</strong></td>
                                <td><span t-field="doc.date"/></td>
                            </tr>
                            <tr>
                                <td><strong>Estado:</strong></td>
                                <td>
                                    <span t-if="doc.state == 'draft'" class="badge badge-secondary">Borrador</span>
                                    <span t-elif="doc.state == 'calculated'" class="badge badge-info">Calculado</span>
                                    <span t-elif="doc.state == 'confirmed'" class="badge badge-warning">Confirmado</span>
                                    <span t-elif="doc.state == 'paid'" class="badge badge-success">Pagado</span>
                                    <span t-else="" class="badge badge-danger">Cancelado</span>
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>
                
                <!-- Cálculo de Ganancia -->
                <h4 class="mt-4">Cálculo de Ganancia Neta</h4>
                <table class="table table-sm table-bordered">
                    <tbody>
                        <tr>
                            <td><strong>Ingresos Brutos</strong></td>
                            <td class="text-right">
                                <span t-field="doc.gross_income" 
                                      t-options='{"widget": "monetary", "display_currency": False}'/>
                            </td>
                        </tr>
                        <tr>
                            <td><strong>Egresos Brutos</strong></td>
                            <td class="text-right">
                                (<span t-field="doc.gross_expenses" 
                                       t-options='{"widget": "monetary", "display_currency": False}'/>)
                            </td>
                        </tr>
                        <tr class="font-weight-bold">
                            <td>Ganancia Bruta</td>
                            <td class="text-right">
                                <span t-field="doc.gross_profit" 
                                      t-options='{"widget": "monetary", "display_currency": False}'/>
                            </td>
                        </tr>
                        <tr>
                            <td><strong>Comisiones de Operadores</strong></td>
                            <td class="text-right">
                                (<span t-field="doc.total_operator_commissions" 
                                       t-options='{"widget": "monetary", "display_currency": False}'/>)
                            </td>
                        </tr>
                        <tr>
                            <td><strong>Costos del Período</strong></td>
                            <td class="text-right">
                                (<span t-field="doc.total_costs" 
                                       t-options='{"widget": "monetary", "display_currency": False}'/>)
                            </td>
                        </tr>
                        <tr>
                            <td class="pl-3">- Costos Fijos</td>
                            <td class="text-right">
                                <span t-field="doc.cost_cf" 
                                      t-options='{"widget": "monetary", "display_currency": False}'/>
                            </td>
                        </tr>
                        <tr>
                            <td class="pl-3">- Costos Variables</td>
                            <td class="text-right">
                                <span t-field="doc.cost_cv" 
                                      t-options='{"widget": "monetary", "display_currency": False}'/>
                            </td>
                        </tr>
                        <tr>
                            <td class="pl-3">- Inversiones</td>
                            <td class="text-right">
                                <span t-field="doc.cost_ci" 
                                      t-options='{"widget": "monetary", "display_currency": False}'/>
                            </td>
                        </tr>
                        <tr>
                            <td class="pl-3">- Impuestos</td>
                            <td class="text-right">
                                <span t-field="doc.cost_imp" 
                                      t-options='{"widget": "monetary", "display_currency": False}'/>
                            </td>
                        </tr>
                        <tr t-if="doc.reinvestment_amount">
                            <td class="pl-3"><em>Monto Reinvertido</em></td>
                            <td class="text-right">
                                <em><span t-field="doc.reinvestment_amount" 
                                          t-options='{"widget": "monetary", "display_currency": False}'/>
                                </em>
                            </td>
                        </tr>
                        <tr class="font-weight-bold bg-light">
                            <td>GANANCIA NETA</td>
                            <td class="text-right">
                                <span t-field="doc.net_profit" 
                                      t-options='{"widget": "monetary", "display_currency": False}'/>
                            </td>
                        </tr>
                    </tbody>
                </table>
                
                <!-- Distribución entre Socios -->
                <h4 class="mt-4">Distribución entre Socios</h4>
                <table class="table table-sm table-bordered">
                    <thead>
                        <tr>
                            <th>Socio</th>
                            <th class="text-right">Participación</th>
                            <th class="text-right">Base</th>
                            <th class="text-right">Comisión</th>
                            <th>Estado</th>
                        </tr>
                    </thead>
                    <tbody>
                        <t t-foreach="doc.line_ids" t-as="line">
                            <tr>
                                <td><span t-field="line.partner_id.name"/></td>
                                <td class="text-right">
                                    <span t-field="line.commission_rate"/>%
                                </td>
                                <td class="text-right">
                                    <span t-field="line.base_amount" 
                                          t-options='{"widget": "monetary", "display_currency": False}'/>
                                </td>
                                <td class="text-right">
                                    <span t-field="line.commission_amount" 
                                          t-options='{"widget": "monetary", "display_currency": False}'/>
                                </td>
                                <td>
                                    <span t-if="line.wallet_movement_id" class="badge badge-success">Pagado</span>
                                    <span t-else="" class="badge badge-warning">Pendiente</span>
                                </td>
                            </tr>
                        </t>
                        <tr class="font-weight-bold">
                            <td colspan="3" class="text-right">TOTAL:</td>
                            <td class="text-right">
                                <span t-field="doc.total_commission" 
                                      t-options='{"widget": "monetary", "display_currency": False}'/>
                            </td>
                            <td></td>
                        </tr>
                    </tbody>
                </table>
                
                <!-- Notas -->
                <div t-if="doc.notes" class="mt-4">
                    <h4>Observaciones</h4>
                    <p t-field="doc.notes"/>
                </div>
                
                <!-- Firmas -->
                <div class="row mt-5">
                    <t t-foreach="doc.line_ids" t-as="line">
                        <div class="col-4 text-center mb-4">
                            <div style="border-top: 1px solid black; margin-top: 50px;">
                                <p class="mt-2">
                                    <strong><span t-field="line.partner_id.name"/></strong><br/>
                                    Socio
                                </p>
                            </div>
                        </div>
                    </t>
                </div>
                
                <div class="oe_structure"/>
            </div>
        </t>
    </template>
    
    <template id="report_partner_commission">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="doc">
                <t t-call="commission_management.report_partner_commission_document"/>
            </t>
        </t>
    </template>
</odoo>