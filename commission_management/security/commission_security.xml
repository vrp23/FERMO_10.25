<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Categoría del módulo -->
    <record id="module_category_commission" model="ir.module.category">
        <field name="name">Gestión de Comisiones</field>
        <field name="description">Gestión de comisiones de operadores y socios</field>
        <field name="sequence">50</field>
    </record>
    
    <!-- Grupos de seguridad -->
    <record id="group_commission_user" model="res.groups">
        <field name="name">Usuario</field>
        <field name="category_id" ref="module_category_commission"/>
        <field name="implied_ids" eval="[(4, ref('base.group_user'))]"/>
        <field name="comment">Puede ver sus propias liquidaciones de comisiones</field>
    </record>
    
    <record id="group_commission_manager" model="res.groups">
        <field name="name">Supervisor</field>
        <field name="category_id" ref="module_category_commission"/>
        <field name="implied_ids" eval="[(4, ref('group_commission_user'))]"/>
        <field name="comment">Puede crear y gestionar liquidaciones de comisiones</field>
    </record>
    
    <record id="group_commission_admin" model="res.groups">
        <field name="name">Administrador</field>
        <field name="category_id" ref="module_category_commission"/>
        <field name="implied_ids" eval="[(4, ref('group_commission_manager'))]"/>
        <field name="comment">Acceso total al módulo de comisiones</field>
    </record>
    
    <!-- Reglas de registro -->
    
    <!-- Liquidaciones de operadores: usuarios ven las suyas, supervisores ven todas -->
    <record id="commission_liquidation_user_rule" model="ir.rule">
        <field name="name">Liquidación: Usuario ve las propias</field>
        <field name="model_id" ref="model_commission_liquidation"/>
        <field name="domain_force">[('operator_id', '=', user.id)]</field>
        <field name="groups" eval="[(4, ref('group_commission_user'))]"/>
        <field name="perm_read" eval="True"/>
        <field name="perm_write" eval="False"/>
        <field name="perm_create" eval="False"/>
        <field name="perm_unlink" eval="False"/>
    </record>
    
    <record id="commission_liquidation_manager_rule" model="ir.rule">
        <field name="name">Liquidación: Supervisor ve todas</field>
        <field name="model_id" ref="model_commission_liquidation"/>
        <field name="domain_force">[(1, '=', 1)]</field>
        <field name="groups" eval="[(4, ref('group_commission_manager'))]"/>
    </record>
    
    <!-- Líneas de liquidación: misma lógica que liquidaciones -->
    <record id="commission_liquidation_line_user_rule" model="ir.rule">
        <field name="name">Línea Liquidación: Usuario ve las propias</field>
        <field name="model_id" ref="model_commission_liquidation_line"/>
        <field name="domain_force">[('liquidation_id.operator_id', '=', user.id)]</field>
        <field name="groups" eval="[(4, ref('group_commission_user'))]"/>
        <field name="perm_read" eval="True"/>
        <field name="perm_write" eval="False"/>
        <field name="perm_create" eval="False"/>
        <field name="perm_unlink" eval="False"/>
    </record>
    
    <record id="commission_liquidation_line_manager_rule" model="ir.rule">
        <field name="name">Línea Liquidación: Supervisor ve todas</field>
        <field name="model_id" ref="model_commission_liquidation_line"/>
        <field name="domain_force">[(1, '=', 1)]</field>
        <field name="groups" eval="[(4, ref('group_commission_manager'))]"/>
    </record>
    
    <!-- Costos: solo supervisores y administradores -->
    <record id="commission_cost_manager_rule" model="ir.rule">
        <field name="name">Costos: Solo supervisores</field>
        <field name="model_id" ref="model_commission_cost"/>
        <field name="domain_force">[(1, '=', 1)]</field>
        <field name="groups" eval="[(4, ref('group_commission_manager'))]"/>
    </record>
    
    <!-- Liquidaciones de socios: solo administradores pueden crear/modificar -->
    <record id="commission_partner_liquidation_user_rule" model="ir.rule">
        <field name="name">Liquidación Socios: Usuarios solo lectura</field>
        <field name="model_id" ref="model_commission_partner_liquidation"/>
        <field name="domain_force">[(1, '=', 1)]</field>
        <field name="groups" eval="[(4, ref('group_commission_user'))]"/>
        <field name="perm_read" eval="True"/>
        <field name="perm_write" eval="False"/>
        <field name="perm_create" eval="False"/>
        <field name="perm_unlink" eval="False"/>
    </record>
    
    <record id="commission_partner_liquidation_admin_rule" model="ir.rule">
        <field name="name">Liquidación Socios: Admin acceso total</field>
        <field name="model_id" ref="model_commission_partner_liquidation"/>
        <field name="domain_force">[(1, '=', 1)]</field>
        <field name="groups" eval="[(4, ref('group_commission_admin'))]"/>
    </record>
</odoo>